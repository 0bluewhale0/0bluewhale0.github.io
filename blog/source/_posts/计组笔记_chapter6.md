---
title: 计组笔记_chapter6
date: 2022-06-07 16:58:41
categories:
	- 笔记
tags:
	- course
	- 计组

cover: /img/v2-65e265085ffd40c14eebc2f141b9f7ad_720w.jpg
---


# 总线系统

## 6.1总线概念&基本结构

总线定义：

是指在功能部件和功能部件之间或设备与设备之间的一组进行互连和传输信息的信号线，
这里信息可以是指令、数据或地址

总线的优点：

- 解决外设多而杂的问题，容易添加新的设备
- 降低成本
- 简化设计

总线的缺点：

- 总线带宽可能限制整条总线的吞吐量

总线的最高速度的影响因素：

- 总线长度
- 负载的设备树
- 负载设备的特性：设备的延迟？设备数据传输率？
  所以我们设计的时候尽量把速度差不多的设备挂在同一条总线上。

总线分类

- 内部总线
- 系统总线
  - 数据总线DBUS，双向，与机器字长，存储字长有关
  - 地址总线ABUS，单向，与存储地址，IO字长有关
  - 控制总线，一般单向
- 设备总线

总线的层次结构
![7](7)

总线的内部结构
![9](9)

总线的特性

总线的性能指标
<!-- ppt11 -->
- 总线宽度
  - 数据线的条数，串，并行性
- 总线传输率（带宽）
- 定时协定
- 信号线数
- 负载能力

<mark>记得换算单位！</mark>

总线的标准化

目前已经出现了很多总线标准：

- PCI
- ISA

总线的连接方式

适配器（又称接口：<!---ppt14--->

单机系统中总线结构的三种基本类型：

- 单总线
- 双总线
- 三总线

>这三种总线基本上是按照不同设备的不同速度进行了不同精度的划分

单总线结构：
![15](15)
双总线结构：
![16](16)
三总线结构：
![17](17)

典型总线：
![ppt18](18)

## 6.2总线接口

### 基本概念

- 信息传送的方式
  - 串行
  - 并行
- 出于速度和效率上的考虑，一般用并行

### 串行传送

- 使用一条传输线，成本低，适合长距离传输，但是速度慢

### 并行传送

一般采用电位传送，每一数据位需要一条传输线
为了节省线的条数，采用分时复用

### 接口的基本概念

- 接口是CPU和主存、外设之间通过总线进行连接的逻辑部件
- 接口的典型功能：控制、缓冲、状态、转换和程序中断
<!-- ppt24 -->


## 6.3总线的仲裁

主设备和从设备的交互称为一个总线事务单元，因此总线事务包括两个部分：

- 发起命令
- 传输数据

总线占用期：主设备持续控制总线的时间

### 集中式仲裁

有点像交通警察在路口指挥交通

#### 链式查询

ppt30
总线请求->转递请求->总线响应->总线忙

总线请求(/BR)和总线忙(/BB)都是低电平有效。

链式查询有隐含的优先级，离仲裁器近的优先级高

优点：

- 实现简单
- 便于增删

缺点：

- 故障敏感，有点像电路，前一个模块出现问题后面的都不能工作
- 仲裁速度慢
- 优先级不能改变，优先级低的设备可能会“饿死”

电路图：
![34]((https://api2.mubu.com/v3/document_image/2a959174-a2b1-4d36-bf90-bc432a6f3d63-16175743.jpg))

#### 计数器定时查询

![jsq](https://api2.mubu.com/v3/document_image/b518873e-2241-4b53-817a-9429bd635a59-16175743.jpg)


#### 独立请求方式

![duli](https://api2.mubu.com/v3/document_image/2248541b-f7d1-4742-bc69-22614b07b832-16175743.jpg)
优点

- 响应时间短
- 控制相当灵活
- 故障不敏感

缺点

- 线路复杂
- 不易增加设备（总线仲裁器的引脚数是定的）

### 分布式仲裁


分布式仲裁不需要集中的总线仲裁器，每个潜在的主方功能模块都有自己的仲裁号和仲裁器。当它们有总线请求时，把它们唯一的**仲裁号**发送到共享的仲裁总线上，每个仲裁器将仲裁总线上得到的号与自己的号进行比较。如果仲裁总线上的号大，则它的总线请求不予响应，并撤销它的仲裁号。最后，获胜者的仲裁号保留在仲裁总线上。显然，分布式仲裁是以优先级仲裁策略为基础。

有点像路口没有警察，所有车辆先停下，确认其他方向没有来车之后再通行

示意图
![tu](https://api2.mubu.com/v3/document_image/b50c15e8-ead4-48de-b290-aaff1ac0fa23-16175743.jpg)

## 6.4 总线的定时和数据传送模式

### 总线的定时


#### 同步定时


#### 异步定时

### 总线数据传送模式

- 读写操作
  - 读操作是由从方到主方的数据传送
  - 写操作是由主方到从方的数据传送

>为了提高总线利用率，减少延时损失，主方完成寻址总线周期后可让出总线控制权，以使其他主方完成更紧迫的操作。然后再重新竞争总线，完成数据传送总线

- 块传送操作
  - 只需给出块的起始地址，然后对固定块长度的数据逐一地读出或写入。对于CPU（主方）-存储器（从方）而言的块传送，常称为突发式传送，其块长一般固定为数据线宽度（存储器字长）的**4倍**

- 写后读、读-修改-写操作
  这是两种组合操作。只给出地址一次（表示同一地址），或进行先写后读操作，或进行先读后写操作。前者用于校验目的，后者用于多道程序系统中对共享存储资源的保护。这两种操作和突发式操作一样，主方掌管总线直到整个操作完成
- 广播、广集操作
  - 一般而言，数据传送只在一个主方和一个从方之间进行。
  - 但有的总线允许**一个主方**对**多个从方**进行写操作，这种操作称为广播。
  - 与广播相反的操作称为广集，它将选定的**多个从方数据**在总线上完成AND或OR操作，用以检测多个中断源。

## 6.5HOST总线和PCI总线

![多总线框图](https://api2.mubu.com/v3/document_image/34b2d4d3-23b7-4a78-836e-8817e697b701-16175743.jpg)

### PCI总线

Peripheral Component Interconnect 周边器件的互联

#### PCI总线信号

#### 总线周期类型
